{% extends 'PerInd.template.base.html' %}

{% load static %}

{% block custom_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'PMU_DjangoWebApps/DataTables/datatables.css' %}" />
{% endblock %}

{% block content %}
    <div class="navbar navbar-expand-lg">
        <!-- Collapse buttons -->
        <div>
            <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                Information: (Expand/Collapse)
            </a>
        </div>
        <!-- / Collapse buttons -->
        <!-- Collapsible element -->
        <div class="collapse" id="collapseExample">
            <div class="mt-3">
                This is the Admin Panel
            </div>
        </div>
        <!-- / Collapsible element -->
        <div class="status_info err_msg">{% if not req_success %} Error: '{{ err_msg }}'<br>Please try reloading the page again!<br>Please contact ykuang@dot.nyc.gov with a screenshot if this error continues. {% else %}{% endif %}</div>
    </div>

    <!--WebGrid-->
    <div>
        <table class="table table-striped table-hover" id="WebGridTable">
            <thead>
                <tr>
                    <th>Login</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Category</th>
                    <th>Active</th>
                </tr>
            </thead>

            <tbody>
                {% for entry in permission_data_entries %}
                <tr>
                    <td class="editable" data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Login">{{ entry.user.login }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="First_Name">{{ entry.user.first_name }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Last_Name">{{ entry.user.last_name }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Category" data-column="Category_Name">{{ entry.category.category_name }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Active_User">{{ entry.user.active_user }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!--End WebGrid-->
{% endblock content %}

{% block custom_js %}
    <script type="text/javascript" charset="utf8" src="{% static 'PMU_DjangoWebApps/DataTables/datatables.js' %}"></script>
    <script type="text/javascript" charset="utf8" src="{% static 'PMU_DjangoWebApps/js/CellEditSave.js' %}"></script>

    <script>
        $(document).ready( function () {

            $('#WebGridTable').DataTable();

            $(document).on("dblclick", ".editable", function () {
                enterCellEditMode($(this))
            });

            $(document).on("keyup", ".input-data", function (e) {
                var key = e.which;
                if (key === 13) { // 13 is the return key, aka 'ENTER' key
                    sendCellToServer(this, "/PerInd/admin_panel_api_save_permission_data", function(td_node, json_response) {
                        console.log(`Hi, call back called sendCellToServer(): ${json_response.post_msg}`)
                    });
                }
                if (key === 27) { // 27 is the ESC key
                    cancelEditMode(this);
                }
            });

        });
    </script>
{% endblock custom_js %}