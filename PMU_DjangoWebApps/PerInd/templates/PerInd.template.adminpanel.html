{% extends 'PerInd.template.base.html' %}

{% load static %}

{% block custom_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'PMU_DjangoWebApps/DataTables/datatables.css' %}" />
{% endblock %}

{% block content %}
    <div class="navbar navbar-expand-lg">
        <!-- Collapse buttons -->
        <div>
            <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                Information: (Expand/Collapse)
            </a>
        </div>
        <!-- / Collapse buttons -->
        <!-- Collapsible element -->
        <div class="collapse" id="collapseExample">
            <div class="mt-3">
                This is the Admin Panel
            </div>
        </div>
        <!-- / Collapsible element -->
        <div class="status_info err_msg">{% if not req_success %} Error: '{{ err_msg }}'<br>Please try reloading the page again!<br>Please contact ykuang@dot.nyc.gov with a screenshot if this error continues. {% else %}{% endif %}</div>
    </div>

    <!--WebGrid-->
    <div>
        <table class="table table-striped table-hover" id="WebGridTable">
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Active User</th>
                    <th>Login</th>
                    <th>Category</th>
                </tr>
            </thead>

            <tbody>
                {% for entry in permission_data_entries %}
                <tr>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="First_Name">{{ entry.user.first_name }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Last_Name">{{ entry.user.last_name }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Active_User">{{ entry.user.active_user }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Users" data-column="Login">{{ entry.user.login }}</td>
                    <td data-id="{{ entry.user_permission_id }}" data-table="Category" data-column="Category_Name">{{ entry.category.category_name }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!--End WebGrid-->
{% endblock content %}

{% block custom_js %}
    <script type="text/javascript" charset="utf8" src="{% static 'PMU_DjangoWebApps/DataTables/datatables.js' %}"></script>
    <script type="text/javascript" charset="utf8" src="{% static 'PMU_DjangoWebApps/js/CellEditSave.js' %}"></script>

    <script>
        $(document).ready( function () {

            $('#WebGridTable').DataTable();

            {% comment %}
                // Example codes showing how CellEditSave.js works with the html table
                // For cell edit mode
                $(document).on("dblclick", ".editable", function () {
                    enterCellEditMode($(this))
                });

                $(document).on("keyup", ".input-data", function (e) {
                    var key = e.which;
                    if (key === 13) { // 13 is the return key, aka 'ENTER' key
                        sendCellToServer(this, "/PerInd/admin_panel_api_save_permission_data", "input", function(td_node, json_response) {
                            console.log(`Hi, call back called sendCellToServer(): ${json_response.post_msg}`)
                        });
                    }
                    if (key === 27) { // 27 is the ESC key
                        cancelEditMode(this);
                    }
                });

                // For cell select mode
                $(document).on("dblclick", ".editable-select", function () {
                    logins_array = {{ user_logins_json|safe }}
                    // Move current select element to the top of the array
                    var current_value = $(this).text()
                    logins_array.sort(function(x, y) {
                        return x == current_value ? -1 : y == current_value ? 1 : 0;
                    });
                    enterCellEditSelectMode($(this), logins_array)
                });

                $(document).on("keyup", ".input-data-select", function (e) {
                    var key = e.which;
                    if (key === 27) { // 27 is the ESC key
                        cancelSelectMode(this);
                    }
                });

                $(document).on("change", ".input-data-select", function () {
                    sendCellToServer(this, "/PerInd/admin_panel_api_save_permission_data", "select", function(td_node, json_response) {
                        console.log(`Hi, call back called sendCellToServer(): ${json_response.post_msg}`)
                    });
                });
            {% endcomment %}

        });
    </script>
{% endblock custom_js %}